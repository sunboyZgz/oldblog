
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>mysql必知必会 - sunBoy</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="sunBoy,"> 
    <meta name="description" content="
最近正在学习使用java开发web应用，我认为一个合格的后端开发者应该掌握基本的sql操作，因此写下此篇记录下学习sql基础时的一些小细节
入门书籍《mysql必知必会》，罗列了我们需要知道的基本,"> 
    <meta name="author" content="Zgz"> 
    <link rel="alternative" href="atom.xml" title="sunBoy" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">sunBoy</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" target="_blank" rel="noopener" href="https://sunboyzgz.github.io/" data-url="https://sunboyzgz.github.io/"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">mysql必知必会</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">mysql必知必会</h1>
        <div class="stuff">
            <span>九月 03, 2021</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E6%8A%80%E6%9C%AF%E6%A0%88/" rel="tag">技术栈</a></li></ul>


        </div>
        <div class="content markdown">
            <blockquote>
<p>最近正在学习使用java开发web应用，我认为一个合格的后端开发者应该掌握基本的sql操作，因此写下此篇记录下学习sql基础时的一些小细节</p>
<p>入门书籍<strong>《mysql必知必会》</strong>，罗列了我们需要知道的基本知识的概念。</p>
<p>sql_script地址：<a target="_blank" rel="noopener" href="https://forta.com/wp-content/uploads/books/0672327120/mysql_scripts.zip">https://forta.com/wp-content/uploads/books/0672327120/mysql_scripts.zip</a></p>
</blockquote>
<h4 id="数据库的简单概念"><a href="#数据库的简单概念" class="headerlink" title="数据库的简单概念"></a>数据库的简单概念</h4><ul>
<li>DBS（database system） ：数据库与数据库管理系统的总称</li>
<li>DB（database） ：数据存放的位置</li>
<li>DBMS（database manage system）：管理数据库的应用程序</li>
</ul>
<p>1.你并不直接访问数据库；你使用的是DBMS，它替你访问数据库。</p>
<p>2.<code>MySQL</code>是一种DBMS，即它是一种数据库软件。</p>
<p>3.<code>SQL</code>是一种专门用来与数据库通信的语言。</p>
<p>4.只有数据库知道SELECT语句中哪些列是实际的 表列，哪些列是计算字段。从客户机（如应用程序）的角度来看，计算 字段的数据是以与其他列的数据相同的方式返回的</p>
<p>5.<code>聚集函数</code>（count、avg、max、min等）操作针对的想要信息的是汇总信息</p>
<h4 id="简单的操作注意点"><a href="#简单的操作注意点" class="headerlink" title="简单的操作注意点"></a>简单的操作注意点</h4><p>1.在处理SQL语句时，其中所有<code>空格都被忽略</code>。SQL 语句可以在一行上给出，也可以分成许多行。同时也<code>s忽略大小写</code></p>
<p>2.检索出来的第一行为行0而不是行1。因此，LIMIT 1, 1 将检索出第二行而不是第一行</p>
<p>3.where 过滤查询信息时，优先进行 AND 逻辑， 后进行 OR逻辑</p>
<p>4.IN操作符一般比OR操作符清单执行更快。 IN的最大优点是可以包含其他SELECT语句，使得能够更动态地建 立WHERE子句。</p>
<p>5.<code>%</code> 代表搜索模式中给定位置的<strong>0个</strong>、1个或多个字符。</p>
<p>6.在确实需要使用通配符时，除非绝对有必要，否则不要把它们用 在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起 来是最慢的。</p>
<p>7.<code>regexp  &#39;str&#39;</code>  默认相当于 <code>like &#39;%str%&#39;</code></p>
<p>8.多数正则表达式实现使用单个反斜杠转义特殊字符， 以便能使用这些字符本身。但MySQL要求两个反斜杠（MySQL 自己解释一个，正则表达式库解释另一个</p>
<p>9.<code>GROUP BY</code>子句和<code>HAVING</code>子句是一对</p>
<p>10.<code>varchar</code>虽然是可变长的但仍需要增加最大长度</p>
<h4 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h4><p><strong>相关子查询</strong>：涉及外部查询的子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customers.cust_name, customers.cust_state,</span><br><span class="line">		(</span><br><span class="line">            <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">            <span class="keyword">from</span> orders</span><br><span class="line">            <span class="keyword">where</span> orders.cust_id <span class="operator">=</span> customers.cust_id</span><br><span class="line">        )</span><br><span class="line"><span class="keyword">from</span> customers</span><br></pre></td></tr></table></figure>
<p>多表联结</p>
<p>联结是利用SQL的SELECT能执行的最重要的操作，很好地理解联结 及其语法是学习SQL的一个极为重要的组成部分。</p>
<p>关系表的设计就是要保证把信息分解成多个表，一类数据 一个表。各表通过某些常用的值（即关系设计中的关系（relational））互 相关联。</p>
<p>外键为某个表中的一列，它包含另一个表 的主键值，定义了两个表之间的关系。</p>
<p>重要的是，要理解联结不是物理实体。换句 话说，它在实际的数据库表中不存在。联结由MySQL根据需 要建立，它存在于查询的执行当中。</p>
<p>在联结两个表时，你实际上做 的是将第一个表中的每一行与第二个表中的每一行配对。</p>
<p><strong>内部联结</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> vendors.vend_name, products.prod_name,products.prod_price</span><br><span class="line"><span class="keyword">from</span> vendors <span class="keyword">inner</span> <span class="keyword">join</span> products</span><br><span class="line"><span class="keyword">on</span> vendors.vend_id <span class="operator">=</span> products.vend_id</span><br></pre></td></tr></table></figure>
<p>与下方表示相同</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> vendors.vend_name, products.prod_name,products.prod_price</span><br><span class="line"><span class="keyword">from</span> vendors, products</span><br><span class="line"><span class="keyword">where</span> vendors.vend_id <span class="operator">=</span> products.vend_id</span><br></pre></td></tr></table></figure>
<p>MySQL在运行时关联指定的每个表以处理联结。 这种处理可能是非常耗费资源的，因此应该仔细，不要联结 不必要的表。联结的表越多，性能下降越厉害。</p>
<p>高级联结</p>
<p>**自联结 **</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p1.prod_name</span><br><span class="line"><span class="keyword">from</span> products <span class="keyword">as</span> p1 <span class="keyword">inner</span> <span class="keyword">join</span> products <span class="keyword">as</span> p</span><br><span class="line"><span class="keyword">on</span> p.prod_id <span class="operator">=</span> <span class="string">&#x27;DTNTR&#x27;</span></span><br><span class="line"><span class="keyword">and</span> p1.vend_id <span class="operator">=</span> p.vend_id</span><br></pre></td></tr></table></figure>
<p><strong>外联结</strong></p>
<p>在使用OUTER JOIN语法时，必须使用RIGHT或LEFT关键字 指定包括其所有行的表</p>
<p>分组结果无法展示一对多关系，只能展示对汇总的关系</p>
<p>Union（组合查询）</p>
<p>UNION中的每个查询必须包含相同的列、表达式或聚集函数（不过各个列不需要以相同的次序列出）。</p>
<p><strong>全文本搜索</strong></p>
<p>并非所有引擎都支持全文本搜索</p>
<p>两个最常使用的引擎为MyISAM和InnoDB， 前者支持全文本搜索，而后者不支持。</p>
<p>启用全文本搜索</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> productnotes(</span><br><span class="line">	note_id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">    note_text text <span class="keyword">null</span>,</span><br><span class="line">    ....,</span><br><span class="line">    <span class="keyword">primary</span> <span class="keyword">key</span>(note_id),</span><br><span class="line">    fulltext(note_text)</span><br><span class="line">) engine<span class="operator">=</span>MyISAM;</span><br></pre></td></tr></table></figure>
<p>正如所见，全文本搜索提供了简单LIKE搜索不能提供的功能。而且， 由于数据是索引的，全文本搜索还相当快。</p>
<p>如果数据检索(query)是最重要的（通常是这样），则你可以通过在 INSERT和INTO之间添加关键字LOW_PRIORITY，指示MySQL 降低INSERT语句的优先级，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> low_priority <span class="keyword">into</span></span><br></pre></td></tr></table></figure>
<p><strong>insert into 性能提升</strong></p>
<p>其中单条INSERT语句有多组值，每组值用一对圆括号括起来， 用逗号分隔。</p>
<p>提高INSERT的性能 此技术可以提高数据库处理的性能，因 为MySQL用单条INSERT语句处理多个插入比使用多条INSERT 语句快。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name (name) <span class="keyword">values</span> (<span class="string">&#x27;zzz&#x27;</span>), (<span class="string">&#x27;ttt&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>insert  into与select</p>
<p>将新表的字段插入已有的表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name(name) <span class="keyword">select</span> name <span class="keyword">from</span> new_table</span><br></pre></td></tr></table></figure>
<p>事实上，MySQL甚至不关心SELECT返回的列名。它使用的是 列的位置，因此SELECT中的第一列（不管其列名）将用来填充 表列中指定的第一个列，第二列将用来填充表列中指定的第二 个列，如此等等。这对于从使用不同列名的表中导入数据是非 常有用的。</p>
<p><strong>update语句</strong></p>
<p>update由三部分构成：</p>
<ul>
<li>表</li>
<li>列名+新值</li>
<li>过滤条件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> table_name</span><br><span class="line"><span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;new name&#x27;</span></span><br><span class="line"><span class="keyword">where</span> cust_id <span class="operator">=</span> <span class="string">&#x27;zzz&#x27;</span></span><br></pre></td></tr></table></figure>
<p>IGNORE关键字 如果用UPDATE语句更新多行，并且在更新这些 行中的一行或多行时出一个现错误，则整个UPDATE操作被取消 （错误发生前更新的所有行被恢复到它们原来的值）。为即使是发 生错误，也继续进行更新，可使用IGNORE关键字，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> IGNORE customers</span><br></pre></td></tr></table></figure>
<h4 id="引擎简介"><a href="#引擎简介" class="headerlink" title="引擎简介"></a>引擎简介</h4><ol>
<li><p><code>InnoDB</code>是一个可靠的事务处理引擎，它不支持全文 本搜索; </p>
</li>
<li><p><code>MEMORY</code>在功能等同于MyISAM，但由于数据存储在内存（不是磁盘） 中，速度很快（特别适合于临时表）； </p>
</li>
<li><p><code>MyISAM</code>是一个性能极高的引擎，它支持全文本搜索， 但不支持事务处理。</p>
</li>
</ol>
<p>外键（用于 强制实施引用完整性）不能跨引擎，即使用一 个引擎的表不能引用具有使用不同引擎的表的外键。</p>
<h4 id="视图与sql复用"><a href="#视图与sql复用" class="headerlink" title="视图与sql复用"></a><strong>视图</strong>与sql复用</h4><p><strong>创建更新一个视图</strong></p>
<p>创建更新<code>productcustomers</code>视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> productcustomers <span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> cust_name, cust_contact</span><br><span class="line"><span class="keyword">from</span> customers, orders,orderitems</span><br><span class="line"><span class="keyword">where</span> customers.cust_id <span class="operator">=</span> orders.cust_id</span><br><span class="line"><span class="keyword">and</span> orderitems.order_num <span class="operator">=</span> orders.order_num</span><br></pre></td></tr></table></figure>
<p><strong>查询一个视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> productcustomers</span><br></pre></td></tr></table></figure>
<p>等价于===&gt;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cust_name, cust_contact</span><br><span class="line"><span class="keyword">from</span> customers, orders,orderitems</span><br><span class="line"><span class="keyword">where</span> customers.cust_id <span class="operator">=</span> orders.cust_id</span><br><span class="line"><span class="keyword">and</span> orderitems.order_num <span class="operator">=</span> orders.order_num</span><br></pre></td></tr></table></figure>


<p>与表一样，视图必须唯一命名（不能给视图取与别的视图或表相 同的名字）。</p>
<p>对于可以创建的视图数目没有限制。</p>
<p>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造 一个视图。</p>
<p>视图不能索引，也不能有关联的触发器或默认值。 </p>
<p> 视图可以和表一起使用。例如，编写一条联结表和视图的SELECT 语句。</p>
<p>对视图进行<code>update类操作</code>会更新视图的基表，但是视图主要用于数据的检索而不是更新</p>
<h4 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a><strong>存储过程</strong></h4><p>有点像批处理</p>
<p>使用存储过程有3个主要的好处，即简单、安全、高性能。</p>
<p>存储过程的调用叫做CALL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> store_process_name()</span><br></pre></td></tr></table></figure>


<p><strong>创建存储过程</strong></p>
<p>用CREATE PROCEDURE productpricing()语 句定义。如果存储过程接受参数，它们将在()中列举出来。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> store_process_name()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">Avg</span>(prod_price) <span class="keyword">as</span> avg_price</span><br><span class="line">	<span class="keyword">from</span> products</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<p>在MySQL处理这段代码时，它创建一个新的存储过程productpricing。没有返回数据，因为这段代码并未调用存储过程，这里只是为 以后使用而创建它。</p>
<p><strong>delimiter</strong>更换分隔符</p>
<p>end后分割符为<code>;</code>后面不能接sql语句，使用<code>delimiter</code>更换成其他分隔符如<code>//</code>可以进行sql</p>
<p><strong>“@“</strong>一个变量的标识符</p>
<p>MySQL支持IN（传递给存储过程）、OUT（从存 储过程传出，如这里所用）和INOUT（对存储过程传入和传出）类型的参 数。</p>
<p><strong>单独<code>OUT</code>案例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> productprincing;</span><br><span class="line">delimiter <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> productprincing(<span class="keyword">out</span> min_price <span class="type">decimal</span>(<span class="number">8</span>,<span class="number">2</span>), <span class="keyword">out</span> max_price <span class="type">decimal</span>(<span class="number">8</span>,<span class="number">2</span>), <span class="keyword">out</span> avg_price <span class="type">decimal</span>(<span class="number">8</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">min</span>(prod_price)</span><br><span class="line">	<span class="keyword">into</span> min_price</span><br><span class="line">	<span class="keyword">from</span> products;</span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">max</span>(prod_price)</span><br><span class="line">	<span class="keyword">into</span> max_price</span><br><span class="line">	<span class="keyword">from</span> products;</span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">avg</span>(prod_price)</span><br><span class="line">	<span class="keyword">into</span> avg_price</span><br><span class="line">	<span class="keyword">from</span> products;</span><br><span class="line"><span class="keyword">end</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> productprincing(<span class="variable">@p1</span>, <span class="variable">@p2</span>, <span class="variable">@p3</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@p1</span>;</span><br></pre></td></tr></table></figure>
<p><strong><code>OUT</code>与<code>IN</code>集合</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> ordertotal;</span><br><span class="line">delimiter <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> ordertotal(</span><br><span class="line">	<span class="keyword">in</span> ordernum <span class="type">int</span>,</span><br><span class="line">	<span class="keyword">out</span> ototal <span class="type">decimal</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"> <span class="keyword">select</span> <span class="built_in">sum</span>(quantity <span class="operator">*</span> item_price)</span><br><span class="line"> <span class="keyword">into</span> ototal</span><br><span class="line"> <span class="keyword">from</span> orderitems</span><br><span class="line"> <span class="keyword">where</span> order_num <span class="operator">=</span> ordernum;</span><br><span class="line"><span class="keyword">end</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> ordertotal(<span class="number">20005</span>, <span class="variable">@total</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@total</span>;</span><br></pre></td></tr></table></figure>
<p>只有在存储过程内包含业务规则和智能处理时， 它们的威力才真正显现出来。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">EXISTS</span> ordertotal;</span><br><span class="line">delimiter <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> ordertotal(</span><br><span class="line">	<span class="keyword">in</span> onumber <span class="type">int</span>,</span><br><span class="line">	<span class="keyword">in</span> taxable <span class="type">boolean</span>,</span><br><span class="line">	<span class="keyword">out</span> ototal <span class="type">decimal</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> total <span class="type">decimal</span>(<span class="number">8</span>,<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">declare</span> taxrate <span class="type">int</span> <span class="keyword">default</span> <span class="number">6</span>;</span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">sum</span>(item_price<span class="operator">*</span>quantity)</span><br><span class="line">	<span class="keyword">from</span> orderitems</span><br><span class="line">	<span class="keyword">where</span> order_num <span class="operator">=</span> onumber</span><br><span class="line">	<span class="keyword">into</span> total;</span><br><span class="line">	if taxable <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">select</span> total <span class="operator">+</span> total <span class="operator">/</span> <span class="number">100</span> <span class="operator">*</span> taxrate <span class="keyword">into</span> total;</span><br><span class="line">	<span class="keyword">end</span> if;</span><br><span class="line">	<span class="keyword">select</span> total <span class="keyword">into</span> ototal;</span><br><span class="line"><span class="keyword">end</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> ordertotal(<span class="number">20005</span>, <span class="number">1</span>, <span class="variable">@ototal</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@ototal</span>;</span><br><span class="line"><span class="keyword">call</span> ordertotal(<span class="number">20005</span>, <span class="number">0</span>, <span class="variable">@ototal</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@ototal</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">procedure</span> status</span><br></pre></td></tr></table></figure>


<h4 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h4><p><code>游标（cursor）</code>是一个存储在MySQL服务器上的数据库查询， 它不是一条SELECT语句，而是被该语句检索出来的结果集。</p>
<p><code>MySQL游标</code>只能用于 存储过程（和函数）。</p>
<p><strong>游标的创建与使用</strong></p>
<ul>
<li>创建语句：<code>declare cursor_name cursor for</code></li>
<li>使用游标：<code>open cursor_name</code></li>
<li>获取下一行数据：<code>fetch cursor_name</code></li>
<li>关闭游标：<code>close cursor</code>(默认在存储过程的end时关闭游标)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> if <span class="keyword">exists</span> processorders;</span><br><span class="line">delimiter <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> processorders(<span class="keyword">out</span> output <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> ordernumbers <span class="keyword">cursor</span></span><br><span class="line">	<span class="keyword">for</span></span><br><span class="line">	<span class="keyword">select</span> order_num <span class="keyword">from</span> orders;</span><br><span class="line">	<span class="keyword">open</span> ordernumbers;</span><br><span class="line">	<span class="keyword">fetch</span> ordernumbers <span class="keyword">into</span> output;</span><br><span class="line"><span class="keyword">end</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">delimiter ;</span><br><span class="line"><span class="keyword">call</span> processorders(<span class="variable">@output</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@output</span>;</span><br></pre></td></tr></table></figure>
<h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><p>响应<code>update</code>、<code>insert</code>、<code>delete</code>语句并触发一个语句执行</p>
<p>mysql中触发器名必 须在每个<strong>表中</strong>唯一，其他dbms不一定统一</p>
<p>只有表才支持触发器，视图不支持（临时表也不 支持）。</p>
<h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p>MyISAM和InnoDB是两种最常使用 的引擎。前者不支持明确的事务处理管理，而后者支持。</p>
<p>事务处理是一种 机制，用来管理必须成批执行的MySQL操作，以保证数据库不包含不完 整的操作结果。</p>
<p>利用事务处理，可以保证一组操作不会中途停止，它们 或者作为整体执行，或者完全不执行（除非明确指示）。</p>
<ul>
<li>事务（transaction）：一组sql</li>
<li>回退（rollback）</li>
<li>提交（commit）</li>
<li>保留点（savepoint）：指事务处理中设置的临时占位符（placeholder），你可以对它发布回退（与回退整个事务处理不同）。</li>
</ul>
<p>你不能回退CREATE或DROP操作。事务处理块中可以使用 这两条语句，但如果你执行回退，它们不会被撤销。</p>
<p>**隐含事务关闭 **：当COMMIT或ROLLBACK语句执行后，事务会自 动关闭</p>
<h4 id="字符集问题"><a href="#字符集问题" class="headerlink" title="字符集问题"></a>字符集问题</h4><p>数据库表被用来存储和检索数据。不同的语言和字符集需要以不同 的方式存储和检索。</p>
<ul>
<li><code>字符集</code>为字母和符号的集合；</li>
<li><code>编码</code>为某个字符集成员的内部表示</li>
<li><code>校对</code>为规定字符如何比较的指令</li>
</ul>
<p>不同的表，甚至不同的列都可能需要不同的字符集，而且两者都 可以在创建表时指定。</p>
<h4 id="访问权限"><a href="#访问权限" class="headerlink" title="访问权限"></a>访问权限</h4><p>应该严肃对待root登录的使用。仅在绝对需 要时使用它（或许在你不能登录其他管理账号时使用）。不应 该在日常的MySQL操作中使用root。</p>
<p>MySQL用户账号和信息存储在名为<code>mysql</code>的MySQL数据库中</p>
<p>mysql数据库管理系统采用一个数据库记录所有的用户信息</p>
<p><strong>创建用户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> user_name identified <span class="keyword">by</span> <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>查看用户权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> user_name;</span><br></pre></td></tr></table></figure>
<p><strong>赋予权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">on</span> database1.<span class="operator">*</span> <span class="keyword">to</span> zgz;</span><br></pre></td></tr></table></figure>
<p>此语句为名为<code>zgz</code>的用户在<code>database1</code>数据库中赋予<code>select</code>的权利</p>
<p><strong>更换口令</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> password <span class="keyword">for</span> zgz <span class="operator">=</span> Password(<span class="string">&#x27;new_password&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h4><h4 id="改善性能"><a href="#改善性能" class="headerlink" title="改善性能"></a>改善性能</h4><ul>
<li>总是有不止一种方法编写同一条SELECT语句。应该试验联结、并、 子查询等，找出最佳的方法。</li>
<li>一般来说，存储过程执行得比一条一条地执行其中的各条MySQL 语句快。 </li>
<li>应该总是使用正确的数据类型。</li>
<li>决不要检索比需求还要多的数据。换言之，不要用SELECT *（除 非你真正需要每个列）。</li>
<li>必须索引数据库表以改善数据检索的性能。</li>
<li>索引改善数据检索的性能，但损害数据插入、删除和更新的性能。</li>
<li>你的SELECT语句中有一系列复杂的OR条件吗？通过使用多条 SELECT语句和连接它们的UNION语句，你能看到极大的性能改 进。</li>
</ul>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p><code>distinct</code>：用于过滤出不一样的select结果</p>
<p>MySQL 5支持LIMIT的另一种替代语法。LIMIT 4 OFFSET 3意为从行3开始取4行，就像LIMIT 3, 4一样。</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci='8d00cc12cdbdc3de1409'
        data-cs='6a1c22eca394bdb3117a91951a80c87c48f98732'
        data-r='sunboyZgz.github.io'
        data-o='sunboyZgz'
        data-a='sunboyZgz'
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
